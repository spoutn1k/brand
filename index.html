<html>

<head>
    <link data-trunk rel="rust" data-bin=brand />
    <link data-trunk rel="scss" href="./index.scss" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>
    <input id=photoselect type=file data-multiple-caption="" multiple />

    <div id=editor class=hidden>
        <div id=header>
            <div id=roll>
                <input id=roll-author-input />
                <input id=roll-make-input />
                <input id=roll-model-input />
                <input id=roll-iso-input />
                <input id=roll-description-input />
            </div>
            <div id=options>
                <button id=editor-reset>Reset</button>
                <button id=editor-selection-clear>Clear selection</button>
                <button id=editor-selection-glob>Select all</button>
                <button id=editor-selection-invert>Invert selection</button>
                <button id=download>Download</button>
            </div>
        </div>

        <table id=exposures>
        </table>
    </div>

    <div id="map" class=hidden></div>

    <script>
        var map;
        var marker;

        document.addEventListener('DOMContentLoaded', (event) => {
            document.getElementById('photoselect').value = ""
        });

        document.addEventListener('DOMContentLoaded', (event) => {
            map = L.map('map').setView([48.8566, 2.3522], 3);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        });

        function prompt_coords(index) {
            document.getElementById("map").classList.toggle("hidden");

            setTimeout(function() {
                map.invalidateSize()
            }, 200);

            function update_exposure(e) {
                const {
                    lat,
                    lng
                } = e.latlng;

                window.wasmBindings.update_coords(index, lat.toFixed(8), lng.toFixed(8));
                if (marker) {
                    map.removeLayer(marker);
                }

                document.getElementById("map").classList.toggle("hidden");

                map.off('click', update_exposure);
            }

            map.on('click', update_exposure);
        }

        function set_marker(lat, lng) {
            if (marker) {
                map.removeLayer(marker);
            }

            marker = L.marker([lat, lng]).addTo(map);
        }
    </script>
</body>

</html>
